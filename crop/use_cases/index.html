
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentación para el desarrollador backend del proyecto AgroInSight">
      
      
      
      
        <link rel="prev" href="../models/">
      
      
        <link rel="next" href="../../cultural_practices/overview/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.39">
    
    
      
        <title>Casos de uso - AgroInsight Backend Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#casos-de-uso-del-modulo-de-cultivos" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AgroInsight Backend Documentation" class="md-header__button md-logo" aria-label="AgroInsight Backend Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AgroInsight Backend Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Casos de uso
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AgroInsight Backend Documentation" class="md-nav__button md-logo" aria-label="AgroInsight Backend Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AgroInsight Backend Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentación complementaria
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Documentación complementaria
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../complement-docs/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descripción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://agroinsight-backend-production.up.railway.app/docs" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FastAPI Swagger
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://agroinsight-backend-production.up.railway.app/redoc" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReDoc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://dbdocs.io/davidvalencia0526/AgroInsight" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.figma.com/design/PwBFnVysZISNgO8UIoOHL1/Agroinsight?node-id=0-1&node-type=CANVAS&t=s9L7qvi4CEiMX9ad-0" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Diseño de interfaz UI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/DavidValenciaX/agroinsight-backend" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repositorio backend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/Alejandroo04/AgroInsight_Front" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repositorio frontend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://usco-team-y6acsy2v.atlassian.net/jira/software/projects/AGROINSHT/boards/1/backlog" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jira
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://drive.google.com/drive/folders/1Nt50sTun-_FQMulYEXsy5aUcIJ7TXKpZ" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sharepoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://join.slack.com/t/agroinsight/shared_invite/zt-2rnhell7b-3~ziopW1zaod0ZD8QP6QFw" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Slack
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guías
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guías
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instalación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guía de inicio rápido
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/useful_tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guía de herramientas útiles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preguntas frecuentes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Módulo de usuarios
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Módulo de usuarios
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descripción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/endpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelos de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/schemas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Esquemas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/use_cases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Casos de uso
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/repository/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repositorio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Módulo de Fincas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Módulo de Fincas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../farm/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descripción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../farm/endpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../farm/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelos de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../farm/use_cases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Casos de uso
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Módulo de lotes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Módulo de lotes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descripción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/endpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelos de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plot/use_cases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Casos de uso
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Módulo de cultivos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Módulo de cultivos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descripción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelos de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Casos de uso
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Casos de uso
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crear-cultivo" class="md-nav__link">
    <span class="md-ellipsis">
      Crear Cultivo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.create_crop_use_case.CreateCropUseCase" class="md-nav__link">
    <span class="md-ellipsis">
      CreateCropUseCase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.create_crop_use_case.CreateCropUseCase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.create_crop_use_case.CreateCropUseCase.create_crop" class="md-nav__link">
    <span class="md-ellipsis">
      create_crop
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listar-variedades-de-maiz" class="md-nav__link">
    <span class="md-ellipsis">
      Listar Variedades de Maíz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase" class="md-nav__link">
    <span class="md-ellipsis">
      ListCornVarietiesUseCase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase.list_corn_varieties" class="md-nav__link">
    <span class="md-ellipsis">
      list_corn_varieties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listar-cultivos-por-lote" class="md-nav__link">
    <span class="md-ellipsis">
      Listar Cultivos por Lote
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase" class="md-nav__link">
    <span class="md-ellipsis">
      ListCropsByPlotUseCase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.list_crops" class="md-nav__link">
    <span class="md-ellipsis">
      list_crops
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Módulo de labores culturales
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Módulo de labores culturales
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cultural_practices/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descripción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cultural_practices/endpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cultural_practices/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelos de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cultural_practices/use_cases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Casos de uso
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Módulo de costos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Módulo de costos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../costs/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descripción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../costs/endpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../costs/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelos de datos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../costs/use_cases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Casos de uso
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Desarrollo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Desarrollo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guía para contribuir al proyecto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/coding_standards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Estándares de codificación
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acerca de
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crear-cultivo" class="md-nav__link">
    <span class="md-ellipsis">
      Crear Cultivo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.create_crop_use_case.CreateCropUseCase" class="md-nav__link">
    <span class="md-ellipsis">
      CreateCropUseCase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.create_crop_use_case.CreateCropUseCase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.create_crop_use_case.CreateCropUseCase.create_crop" class="md-nav__link">
    <span class="md-ellipsis">
      create_crop
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listar-variedades-de-maiz" class="md-nav__link">
    <span class="md-ellipsis">
      Listar Variedades de Maíz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase" class="md-nav__link">
    <span class="md-ellipsis">
      ListCornVarietiesUseCase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase.list_corn_varieties" class="md-nav__link">
    <span class="md-ellipsis">
      list_corn_varieties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listar-cultivos-por-lote" class="md-nav__link">
    <span class="md-ellipsis">
      Listar Cultivos por Lote
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase" class="md-nav__link">
    <span class="md-ellipsis">
      ListCropsByPlotUseCase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.list_crops" class="md-nav__link">
    <span class="md-ellipsis">
      list_crops
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="casos-de-uso-del-modulo-de-cultivos">Casos de Uso del Módulo de Cultivos</h1>
<h2 id="crear-cultivo">Crear Cultivo</h2>


<div class="doc doc-object doc-class">



<a id="app.crop.application.create_crop_use_case.CreateCropUseCase"></a>
    <div class="doc doc-contents first">


        <p>Caso de uso para crear un nuevo cultivo.</p>
<p>Esta clase maneja la lógica de negocio necesaria para crear un cultivo en un lote,
incluyendo validaciones de permisos y existencia de recursos.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.create_crop_use_case.CreateCropUseCase.db">db</span></code></td>
            <td>
                  <code><span title="sqlalchemy.orm.Session">Session</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sesión de base de datos SQLAlchemy.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.create_crop_use_case.CreateCropUseCase.crop_repository">crop_repository</span></code></td>
            <td>
                  <code><span title="app.crop.infrastructure.sql_repository.CropRepository">CropRepository</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Repositorio para operaciones con cultivos.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.create_crop_use_case.CreateCropUseCase.plot_repository">plot_repository</span></code></td>
            <td>
                  <code><span title="app.plot.infrastructure.sql_repository.PlotRepository">PlotRepository</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Repositorio para operaciones con lotes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.create_crop_use_case.CreateCropUseCase.farm_repository">farm_repository</span></code></td>
            <td>
                  <code><span title="app.farm.infrastructure.sql_repository.FarmRepository">FarmRepository</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Repositorio para operaciones con fincas.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.create_crop_use_case.CreateCropUseCase.farm_service">farm_service</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.farm.application.services.farm_service.FarmService" href="../../farm/use_cases/#app.farm.application.services.farm_service.FarmService">FarmService</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Servicio para lógica de negocio de fincas.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.create_crop_use_case.CreateCropUseCase.measurement_service">measurement_service</span></code></td>
            <td>
                  <code><span title="app.measurement.application.services.measurement_service.MeasurementService">MeasurementService</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Servicio para lógica de negocio de medidas.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.create_crop_use_case.CreateCropUseCase.measurement_repository">measurement_repository</span></code></td>
            <td>
                  <code><span title="app.measurement.infrastructure.sql_repository.MeasurementRepository">MeasurementRepository</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Repositorio para operaciones con medidas.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>app\crop\application\create_crop_use_case.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CreateCropUseCase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Caso de uso para crear un nuevo cultivo.</span>

<span class="sd">    Esta clase maneja la lógica de negocio necesaria para crear un cultivo en un lote,</span>
<span class="sd">    incluyendo validaciones de permisos y existencia de recursos.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        db (Session): Sesión de base de datos SQLAlchemy.</span>
<span class="sd">        crop_repository (CropRepository): Repositorio para operaciones con cultivos.</span>
<span class="sd">        plot_repository (PlotRepository): Repositorio para operaciones con lotes.</span>
<span class="sd">        farm_repository (FarmRepository): Repositorio para operaciones con fincas.</span>
<span class="sd">        farm_service (FarmService): Servicio para lógica de negocio de fincas.</span>
<span class="sd">        measurement_service (MeasurementService): Servicio para lógica de negocio de medidas.</span>
<span class="sd">        measurement_repository (MeasurementRepository): Repositorio para operaciones con medidas.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inicializa el caso de uso con las dependencias necesarias.</span>

<span class="sd">        Args:</span>
<span class="sd">            db (Session): Sesión de base de datos SQLAlchemy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span> <span class="o">=</span> <span class="n">CropRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_repository</span> <span class="o">=</span> <span class="n">PlotRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">farm_repository</span> <span class="o">=</span> <span class="n">FarmRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">farm_service</span> <span class="o">=</span> <span class="n">FarmService</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_service</span> <span class="o">=</span> <span class="n">MeasurementService</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement_repository</span> <span class="o">=</span> <span class="n">MeasurementRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_crop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crop_data</span><span class="p">:</span> <span class="n">CropCreate</span><span class="p">,</span> <span class="n">current_user</span><span class="p">:</span> <span class="n">UserInDB</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SuccessResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Crea un nuevo cultivo en la base de datos.</span>

<span class="sd">        Este método realiza las siguientes validaciones antes de crear el cultivo:</span>
<span class="sd">        1. Verifica que el lote especificado exista.</span>
<span class="sd">        2. Obtiene la finca asociada al lote y verifica su existencia.</span>
<span class="sd">        3. Valida que el usuario tenga permisos para crear cultivos en la finca.</span>
<span class="sd">        4. Verifica que la variedad de maíz especificada exista.</span>
<span class="sd">        5. Verifica que la unidad de medida para la densidad de siembra exista y sea válida.</span>
<span class="sd">        6. Verifica que el estado del cultivo especificado exista.</span>
<span class="sd">        7. Verifica que no exista un cultivo activo en el lote.</span>

<span class="sd">        Args:</span>
<span class="sd">            crop_data (CropCreate): Datos del cultivo a crear.</span>
<span class="sd">            current_user (UserInDB): Usuario que está creando el cultivo.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SuccessResponse: Respuesta exitosa con un mensaje de confirmación.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DomainException: Si ocurre algún error de validación:</span>
<span class="sd">                - 404: El lote, la finca, la variedad de maíz, la unidad de medida o el estado del cultivo no existen.</span>
<span class="sd">                - 403: El usuario no tiene permisos para crear cultivos en la finca.</span>
<span class="sd">                - 409: Ya existe un cultivo activo en el lote.</span>
<span class="sd">                - 500: Error al crear el cultivo.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Obtener el lote</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_repository</span><span class="o">.</span><span class="n">get_plot_by_id</span><span class="p">(</span><span class="n">crop_data</span><span class="o">.</span><span class="n">lote_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo obtener el lote especificado.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
            <span class="p">)</span>

        <span class="c1"># Obtener la finca asociada al lote</span>
        <span class="n">farm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">farm_repository</span><span class="o">.</span><span class="n">get_farm_by_id</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">finca_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">farm</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo obtener la finca asociada al lote.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
            <span class="p">)</span>

        <span class="c1"># Validar que el usuario sea administrador de la finca</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">farm_service</span><span class="o">.</span><span class="n">user_is_farm_admin</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">farm</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No tienes permisos para crear cultivos en esta finca.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span>
            <span class="p">)</span>

        <span class="c1"># Verificar si la variedad de maíz existe</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">get_corn_variety_by_id</span><span class="p">(</span><span class="n">crop_data</span><span class="o">.</span><span class="n">variedad_maiz_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;La variedad de maíz especificada no existe.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
            <span class="p">)</span>

        <span class="c1"># Verificar si la unidad de medida para densidad de siembra existe</span>
        <span class="n">unit_of_measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_repository</span><span class="o">.</span><span class="n">get_unit_of_measure_by_id</span><span class="p">(</span><span class="n">crop_data</span><span class="o">.</span><span class="n">densidad_siembra_unidad_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unit_of_measure</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;La unidad de medida para densidad de siembra especificada no existe.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
            <span class="p">)</span>

        <span class="c1"># verificar que la unidad de medida para densidad de siembra sea de densidad de siembra</span>
        <span class="n">unit_category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_repository</span><span class="o">.</span><span class="n">get_unit_category_by_id</span><span class="p">(</span><span class="n">unit_of_measure</span><span class="o">.</span><span class="n">categoria_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unit_category</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo obtener la categoría de la unidad de medida para densidad de siembra.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">unit_category</span><span class="o">.</span><span class="n">nombre</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_service</span><span class="o">.</span><span class="n">UNIT_CATEGORY_PLANTING_DENSITY_NAME</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;La unidad de medida elegida no es de densidad de siembra.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span>
            <span class="p">)</span>

        <span class="c1"># Verificar si el estado del cultivo existe</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">get_crop_state_by_id</span><span class="p">(</span><span class="n">crop_data</span><span class="o">.</span><span class="n">estado_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;El estado de cultivo especificado no existe.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
            <span class="p">)</span>

        <span class="c1"># Verificar si ya existe un cultivo activo en el lote</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">has_active_crop</span><span class="p">(</span><span class="n">crop_data</span><span class="o">.</span><span class="n">lote_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Ya existe un cultivo activo en este lote.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_409_CONFLICT</span>
            <span class="p">)</span>

        <span class="c1"># Crear el cultivo</span>
        <span class="n">crop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">create_crop</span><span class="p">(</span><span class="n">crop_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">crop</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo crear el cultivo.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">SuccessResponse</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Cultivo creado exitosamente&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="app.crop.application.create_crop_use_case.CreateCropUseCase.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">db</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Inicializa el caso de uso con las dependencias necesarias.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>db</code></td>
            <td>
                  <code><span title="sqlalchemy.orm.Session">Session</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sesión de base de datos SQLAlchemy.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app\crop\application\create_crop_use_case.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inicializa el caso de uso con las dependencias necesarias.</span>

<span class="sd">    Args:</span>
<span class="sd">        db (Session): Sesión de base de datos SQLAlchemy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span> <span class="o">=</span> <span class="n">CropRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_repository</span> <span class="o">=</span> <span class="n">PlotRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">farm_repository</span> <span class="o">=</span> <span class="n">FarmRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">farm_service</span> <span class="o">=</span> <span class="n">FarmService</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_service</span> <span class="o">=</span> <span class="n">MeasurementService</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measurement_repository</span> <span class="o">=</span> <span class="n">MeasurementRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="app.crop.application.create_crop_use_case.CreateCropUseCase.create_crop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_crop</span><span class="p">(</span><span class="n">crop_data</span><span class="p">,</span> <span class="n">current_user</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Crea un nuevo cultivo en la base de datos.</p>
<p>Este método realiza las siguientes validaciones antes de crear el cultivo:
1. Verifica que el lote especificado exista.
2. Obtiene la finca asociada al lote y verifica su existencia.
3. Valida que el usuario tenga permisos para crear cultivos en la finca.
4. Verifica que la variedad de maíz especificada exista.
5. Verifica que la unidad de medida para la densidad de siembra exista y sea válida.
6. Verifica que el estado del cultivo especificado exista.
7. Verifica que no exista un cultivo activo en el lote.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>crop_data</code></td>
            <td>
                  <code><span title="app.crop.domain.schemas.CropCreate">CropCreate</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Datos del cultivo a crear.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>current_user</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.user.domain.schemas.UserInDB" href="../../user/schemas/#app.user.domain.schemas.UserInDB">UserInDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Usuario que está creando el cultivo.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>SuccessResponse</code></td>            <td>
                  <code><span title="app.infrastructure.common.response_models.SuccessResponse">SuccessResponse</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Respuesta exitosa con un mensaje de confirmación.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="app.infrastructure.common.common_exceptions.DomainException">DomainException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si ocurre algún error de validación:
- 404: El lote, la finca, la variedad de maíz, la unidad de medida o el estado del cultivo no existen.
- 403: El usuario no tiene permisos para crear cultivos en la finca.
- 409: Ya existe un cultivo activo en el lote.
- 500: Error al crear el cultivo.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app\crop\application\create_crop_use_case.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_crop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crop_data</span><span class="p">:</span> <span class="n">CropCreate</span><span class="p">,</span> <span class="n">current_user</span><span class="p">:</span> <span class="n">UserInDB</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SuccessResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Crea un nuevo cultivo en la base de datos.</span>

<span class="sd">    Este método realiza las siguientes validaciones antes de crear el cultivo:</span>
<span class="sd">    1. Verifica que el lote especificado exista.</span>
<span class="sd">    2. Obtiene la finca asociada al lote y verifica su existencia.</span>
<span class="sd">    3. Valida que el usuario tenga permisos para crear cultivos en la finca.</span>
<span class="sd">    4. Verifica que la variedad de maíz especificada exista.</span>
<span class="sd">    5. Verifica que la unidad de medida para la densidad de siembra exista y sea válida.</span>
<span class="sd">    6. Verifica que el estado del cultivo especificado exista.</span>
<span class="sd">    7. Verifica que no exista un cultivo activo en el lote.</span>

<span class="sd">    Args:</span>
<span class="sd">        crop_data (CropCreate): Datos del cultivo a crear.</span>
<span class="sd">        current_user (UserInDB): Usuario que está creando el cultivo.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SuccessResponse: Respuesta exitosa con un mensaje de confirmación.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DomainException: Si ocurre algún error de validación:</span>
<span class="sd">            - 404: El lote, la finca, la variedad de maíz, la unidad de medida o el estado del cultivo no existen.</span>
<span class="sd">            - 403: El usuario no tiene permisos para crear cultivos en la finca.</span>
<span class="sd">            - 409: Ya existe un cultivo activo en el lote.</span>
<span class="sd">            - 500: Error al crear el cultivo.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Obtener el lote</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_repository</span><span class="o">.</span><span class="n">get_plot_by_id</span><span class="p">(</span><span class="n">crop_data</span><span class="o">.</span><span class="n">lote_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo obtener el lote especificado.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
        <span class="p">)</span>

    <span class="c1"># Obtener la finca asociada al lote</span>
    <span class="n">farm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">farm_repository</span><span class="o">.</span><span class="n">get_farm_by_id</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">finca_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">farm</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo obtener la finca asociada al lote.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
        <span class="p">)</span>

    <span class="c1"># Validar que el usuario sea administrador de la finca</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">farm_service</span><span class="o">.</span><span class="n">user_is_farm_admin</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">farm</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No tienes permisos para crear cultivos en esta finca.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span>
        <span class="p">)</span>

    <span class="c1"># Verificar si la variedad de maíz existe</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">get_corn_variety_by_id</span><span class="p">(</span><span class="n">crop_data</span><span class="o">.</span><span class="n">variedad_maiz_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;La variedad de maíz especificada no existe.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
        <span class="p">)</span>

    <span class="c1"># Verificar si la unidad de medida para densidad de siembra existe</span>
    <span class="n">unit_of_measure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_repository</span><span class="o">.</span><span class="n">get_unit_of_measure_by_id</span><span class="p">(</span><span class="n">crop_data</span><span class="o">.</span><span class="n">densidad_siembra_unidad_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">unit_of_measure</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;La unidad de medida para densidad de siembra especificada no existe.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
        <span class="p">)</span>

    <span class="c1"># verificar que la unidad de medida para densidad de siembra sea de densidad de siembra</span>
    <span class="n">unit_category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_repository</span><span class="o">.</span><span class="n">get_unit_category_by_id</span><span class="p">(</span><span class="n">unit_of_measure</span><span class="o">.</span><span class="n">categoria_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">unit_category</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo obtener la categoría de la unidad de medida para densidad de siembra.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">unit_category</span><span class="o">.</span><span class="n">nombre</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measurement_service</span><span class="o">.</span><span class="n">UNIT_CATEGORY_PLANTING_DENSITY_NAME</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;La unidad de medida elegida no es de densidad de siembra.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span>
        <span class="p">)</span>

    <span class="c1"># Verificar si el estado del cultivo existe</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">get_crop_state_by_id</span><span class="p">(</span><span class="n">crop_data</span><span class="o">.</span><span class="n">estado_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;El estado de cultivo especificado no existe.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
        <span class="p">)</span>

    <span class="c1"># Verificar si ya existe un cultivo activo en el lote</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">has_active_crop</span><span class="p">(</span><span class="n">crop_data</span><span class="o">.</span><span class="n">lote_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Ya existe un cultivo activo en este lote.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_409_CONFLICT</span>
        <span class="p">)</span>

    <span class="c1"># Crear el cultivo</span>
    <span class="n">crop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">create_crop</span><span class="p">(</span><span class="n">crop_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">crop</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo crear el cultivo.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">SuccessResponse</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Cultivo creado exitosamente&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="listar-variedades-de-maiz">Listar Variedades de Maíz</h2>


<div class="doc doc-object doc-class">



<a id="app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase"></a>
    <div class="doc doc-contents first">


        <p>Caso de uso para listar las variedades de maíz.</p>
<p>Esta clase maneja la lógica de negocio necesaria para obtener todas las variedades de maíz
disponibles en el sistema.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase.db">db</span></code></td>
            <td>
                  <code><span title="sqlalchemy.orm.Session">Session</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sesión de base de datos SQLAlchemy.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase.crop_repository">crop_repository</span></code></td>
            <td>
                  <code><span title="app.crop.infrastructure.sql_repository.CropRepository">CropRepository</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Repositorio para operaciones con cultivos.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>app\crop\application\list_corn_varieties_use_case.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ListCornVarietiesUseCase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Caso de uso para listar las variedades de maíz.</span>

<span class="sd">    Esta clase maneja la lógica de negocio necesaria para obtener todas las variedades de maíz</span>
<span class="sd">    disponibles en el sistema.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        db (Session): Sesión de base de datos SQLAlchemy.</span>
<span class="sd">        crop_repository (CropRepository): Repositorio para operaciones con cultivos.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inicializa el caso de uso con las dependencias necesarias.</span>

<span class="sd">        Args:</span>
<span class="sd">            db (Session): Sesión de base de datos SQLAlchemy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span> <span class="o">=</span> <span class="n">CropRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_corn_varieties</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CornVarietyListResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Lista todas las variedades de maíz disponibles.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CornVarietyListResponse: Objeto con la lista de variedades de maíz.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DomainException: Si ocurre un error al obtener las variedades.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">varieties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">get_all_corn_varieties</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">varieties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Error al obtener las variedades de maíz&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varieties</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No hay variedades de maíz registradas&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">CornVarietyListResponse</span><span class="p">(</span><span class="n">varieties</span><span class="o">=</span><span class="n">varieties</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">db</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Inicializa el caso de uso con las dependencias necesarias.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>db</code></td>
            <td>
                  <code><span title="sqlalchemy.orm.Session">Session</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sesión de base de datos SQLAlchemy.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app\crop\application\list_corn_varieties_use_case.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inicializa el caso de uso con las dependencias necesarias.</span>

<span class="sd">    Args:</span>
<span class="sd">        db (Session): Sesión de base de datos SQLAlchemy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span> <span class="o">=</span> <span class="n">CropRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="app.crop.application.list_corn_varieties_use_case.ListCornVarietiesUseCase.list_corn_varieties" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_corn_varieties</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Lista todas las variedades de maíz disponibles.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>CornVarietyListResponse</code></td>            <td>
                  <code><span title="app.crop.domain.schemas.CornVarietyListResponse">CornVarietyListResponse</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Objeto con la lista de variedades de maíz.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="app.infrastructure.common.common_exceptions.DomainException">DomainException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si ocurre un error al obtener las variedades.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app\crop\application\list_corn_varieties_use_case.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">list_corn_varieties</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CornVarietyListResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lista todas las variedades de maíz disponibles.</span>

<span class="sd">    Returns:</span>
<span class="sd">        CornVarietyListResponse: Objeto con la lista de variedades de maíz.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DomainException: Si ocurre un error al obtener las variedades.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">varieties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">get_all_corn_varieties</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">varieties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Error al obtener las variedades de maíz&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varieties</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No hay variedades de maíz registradas&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">CornVarietyListResponse</span><span class="p">(</span><span class="n">varieties</span><span class="o">=</span><span class="n">varieties</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="listar-cultivos-por-lote">Listar Cultivos por Lote</h2>


<div class="doc doc-object doc-class">



<a id="app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase"></a>
    <div class="doc doc-contents first">


        <p>Caso de uso para listar los cultivos de un lote específico.</p>
<p>Esta clase maneja la lógica de negocio necesaria para obtener una lista paginada
de los cultivos que pertenecen a un lote específico, asegurando que el usuario
tenga los permisos adecuados.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.db">db</span></code></td>
            <td>
                  <code><span title="sqlalchemy.orm.Session">Session</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sesión de base de datos SQLAlchemy.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.crop_repository">crop_repository</span></code></td>
            <td>
                  <code><span title="app.crop.infrastructure.sql_repository.CropRepository">CropRepository</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Repositorio para operaciones con cultivos.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.plot_repository">plot_repository</span></code></td>
            <td>
                  <code><span title="app.plot.infrastructure.sql_repository.PlotRepository">PlotRepository</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Repositorio para operaciones con lotes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.farm_repository">farm_repository</span></code></td>
            <td>
                  <code><span title="app.farm.infrastructure.sql_repository.FarmRepository">FarmRepository</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Repositorio para operaciones con fincas.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.farm_service">farm_service</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.farm.application.services.farm_service.FarmService" href="../../farm/use_cases/#app.farm.application.services.farm_service.FarmService">FarmService</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Servicio para lógica de negocio de fincas.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.user_repository">user_repository</span></code></td>
            <td>
                  <code><span title="app.user.infrastructure.sql_repository.UserRepository">UserRepository</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Repositorio para operaciones con usuarios.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>app\crop\application\list_crops_by_plot_use_case.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ListCropsByPlotUseCase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Caso de uso para listar los cultivos de un lote específico.</span>

<span class="sd">    Esta clase maneja la lógica de negocio necesaria para obtener una lista paginada</span>
<span class="sd">    de los cultivos que pertenecen a un lote específico, asegurando que el usuario</span>
<span class="sd">    tenga los permisos adecuados.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        db (Session): Sesión de base de datos SQLAlchemy.</span>
<span class="sd">        crop_repository (CropRepository): Repositorio para operaciones con cultivos.</span>
<span class="sd">        plot_repository (PlotRepository): Repositorio para operaciones con lotes.</span>
<span class="sd">        farm_repository (FarmRepository): Repositorio para operaciones con fincas.</span>
<span class="sd">        farm_service (FarmService): Servicio para lógica de negocio de fincas.</span>
<span class="sd">        user_repository (UserRepository): Repositorio para operaciones con usuarios.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inicializa el caso de uso con las dependencias necesarias.</span>

<span class="sd">        Args:</span>
<span class="sd">            db (Session): Sesión de base de datos SQLAlchemy.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span> <span class="o">=</span> <span class="n">CropRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_repository</span> <span class="o">=</span> <span class="n">PlotRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">farm_repository</span> <span class="o">=</span> <span class="n">FarmRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">farm_service</span> <span class="o">=</span> <span class="n">FarmService</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_repository</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">list_crops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">per_page</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">current_user</span><span class="p">:</span> <span class="n">UserInDB</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedCropListResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Lista los cultivos de un lote específico de forma paginada.</span>

<span class="sd">        Este método realiza las siguientes validaciones:</span>
<span class="sd">        1. Verifica si el lote especificado existe.</span>
<span class="sd">        2. Obtiene la finca asociada al lote y verifica su existencia.</span>
<span class="sd">        3. Verifica que el usuario tenga acceso a la finca.</span>

<span class="sd">        Args:</span>
<span class="sd">            plot_id (int): ID del lote del cual se quieren listar los cultivos.</span>
<span class="sd">            page (int): Número de página actual para la paginación.</span>
<span class="sd">            per_page (int): Cantidad de cultivos por página.</span>
<span class="sd">            current_user (UserInDB): Usuario que está solicitando la lista de cultivos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PaginatedCropListResponse: Respuesta paginada que incluye:</span>
<span class="sd">                - Lista de cultivos para la página actual.</span>
<span class="sd">                - Total de cultivos.</span>
<span class="sd">                - Número de página actual.</span>
<span class="sd">                - Cantidad de elementos por página.</span>
<span class="sd">                - Total de páginas.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DomainException: Si ocurre algún error de validación:</span>
<span class="sd">                - 404: El lote o la finca no existen.</span>
<span class="sd">                - 403: El usuario no tiene permisos para ver los cultivos de este lote.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verificar si el lote existe</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_repository</span><span class="o">.</span><span class="n">get_plot_by_id</span><span class="p">(</span><span class="n">plot_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;El lote especificado no existe.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
            <span class="p">)</span>

        <span class="c1"># Obtener la finca asociada al lote</span>
        <span class="n">farm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">farm_repository</span><span class="o">.</span><span class="n">get_farm_by_id</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">finca_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">farm</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo obtener la finca asociada al lote.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
            <span class="p">)</span>

        <span class="c1"># Verificar que el usuario tenga acceso a la finca</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_repository</span><span class="o">.</span><span class="n">get_user_by_id</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo obtener el usuario.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
            <span class="p">)</span>

        <span class="n">nombre_usuario</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="n">apellido</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">farm_service</span><span class="o">.</span><span class="n">user_is_farm_admin</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">farm</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;El usuario </span><span class="si">{</span><span class="n">nombre_usuario</span><span class="si">}</span><span class="s2"> con email </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="si">}</span><span class="s2"> no tiene permisos para ver los cultivos de este lote.&quot;</span><span class="p">,</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span>
            <span class="p">)</span>

        <span class="c1"># Obtener los cultivos</span>
        <span class="n">total_crops</span><span class="p">,</span> <span class="n">crops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">get_crops_by_plot_id_paginated</span><span class="p">(</span><span class="n">plot_id</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">per_page</span><span class="p">)</span>

        <span class="n">total_pages</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">total_crops</span> <span class="o">/</span> <span class="n">per_page</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PaginatedCropListResponse</span><span class="p">(</span>
            <span class="n">crops</span><span class="o">=</span><span class="n">crops</span><span class="p">,</span>
            <span class="n">total_crops</span><span class="o">=</span><span class="n">total_crops</span><span class="p">,</span>
            <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
            <span class="n">per_page</span><span class="o">=</span><span class="n">per_page</span><span class="p">,</span>
            <span class="n">total_pages</span><span class="o">=</span><span class="n">total_pages</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">db</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Inicializa el caso de uso con las dependencias necesarias.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>db</code></td>
            <td>
                  <code><span title="sqlalchemy.orm.Session">Session</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sesión de base de datos SQLAlchemy.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app\crop\application\list_crops_by_plot_use_case.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="n">Session</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inicializa el caso de uso con las dependencias necesarias.</span>

<span class="sd">    Args:</span>
<span class="sd">        db (Session): Sesión de base de datos SQLAlchemy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span> <span class="o">=</span> <span class="n">CropRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_repository</span> <span class="o">=</span> <span class="n">PlotRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">farm_repository</span> <span class="o">=</span> <span class="n">FarmRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">farm_service</span> <span class="o">=</span> <span class="n">FarmService</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">user_repository</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="app.crop.application.list_crops_by_plot_use_case.ListCropsByPlotUseCase.list_crops" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">list_crops</span><span class="p">(</span><span class="n">plot_id</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">per_page</span><span class="p">,</span> <span class="n">current_user</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Lista los cultivos de un lote específico de forma paginada.</p>
<p>Este método realiza las siguientes validaciones:
1. Verifica si el lote especificado existe.
2. Obtiene la finca asociada al lote y verifica su existencia.
3. Verifica que el usuario tenga acceso a la finca.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>plot_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID del lote del cual se quieren listar los cultivos.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>page</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Número de página actual para la paginación.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>per_page</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cantidad de cultivos por página.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>current_user</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.user.domain.schemas.UserInDB" href="../../user/schemas/#app.user.domain.schemas.UserInDB">UserInDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Usuario que está solicitando la lista de cultivos.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PaginatedCropListResponse</code></td>            <td>
                  <code><span title="app.crop.domain.schemas.PaginatedCropListResponse">PaginatedCropListResponse</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Respuesta paginada que incluye:
- Lista de cultivos para la página actual.
- Total de cultivos.
- Número de página actual.
- Cantidad de elementos por página.
- Total de páginas.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="app.infrastructure.common.common_exceptions.DomainException">DomainException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si ocurre algún error de validación:
- 404: El lote o la finca no existen.
- 403: El usuario no tiene permisos para ver los cultivos de este lote.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app\crop\application\list_crops_by_plot_use_case.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">list_crops</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">per_page</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">current_user</span><span class="p">:</span> <span class="n">UserInDB</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedCropListResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lista los cultivos de un lote específico de forma paginada.</span>

<span class="sd">    Este método realiza las siguientes validaciones:</span>
<span class="sd">    1. Verifica si el lote especificado existe.</span>
<span class="sd">    2. Obtiene la finca asociada al lote y verifica su existencia.</span>
<span class="sd">    3. Verifica que el usuario tenga acceso a la finca.</span>

<span class="sd">    Args:</span>
<span class="sd">        plot_id (int): ID del lote del cual se quieren listar los cultivos.</span>
<span class="sd">        page (int): Número de página actual para la paginación.</span>
<span class="sd">        per_page (int): Cantidad de cultivos por página.</span>
<span class="sd">        current_user (UserInDB): Usuario que está solicitando la lista de cultivos.</span>

<span class="sd">    Returns:</span>
<span class="sd">        PaginatedCropListResponse: Respuesta paginada que incluye:</span>
<span class="sd">            - Lista de cultivos para la página actual.</span>
<span class="sd">            - Total de cultivos.</span>
<span class="sd">            - Número de página actual.</span>
<span class="sd">            - Cantidad de elementos por página.</span>
<span class="sd">            - Total de páginas.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DomainException: Si ocurre algún error de validación:</span>
<span class="sd">            - 404: El lote o la finca no existen.</span>
<span class="sd">            - 403: El usuario no tiene permisos para ver los cultivos de este lote.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verificar si el lote existe</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_repository</span><span class="o">.</span><span class="n">get_plot_by_id</span><span class="p">(</span><span class="n">plot_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">plot</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;El lote especificado no existe.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
        <span class="p">)</span>

    <span class="c1"># Obtener la finca asociada al lote</span>
    <span class="n">farm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">farm_repository</span><span class="o">.</span><span class="n">get_farm_by_id</span><span class="p">(</span><span class="n">plot</span><span class="o">.</span><span class="n">finca_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">farm</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo obtener la finca asociada al lote.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
        <span class="p">)</span>

    <span class="c1"># Verificar que el usuario tenga acceso a la finca</span>
    <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_repository</span><span class="o">.</span><span class="n">get_user_by_id</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No se pudo obtener el usuario.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span>
        <span class="p">)</span>

    <span class="n">nombre_usuario</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="n">apellido</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">farm_service</span><span class="o">.</span><span class="n">user_is_farm_admin</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">farm</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DomainException</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;El usuario </span><span class="si">{</span><span class="n">nombre_usuario</span><span class="si">}</span><span class="s2"> con email </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="si">}</span><span class="s2"> no tiene permisos para ver los cultivos de este lote.&quot;</span><span class="p">,</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span>
        <span class="p">)</span>

    <span class="c1"># Obtener los cultivos</span>
    <span class="n">total_crops</span><span class="p">,</span> <span class="n">crops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_repository</span><span class="o">.</span><span class="n">get_crops_by_plot_id_paginated</span><span class="p">(</span><span class="n">plot_id</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">per_page</span><span class="p">)</span>

    <span class="n">total_pages</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">total_crops</span> <span class="o">/</span> <span class="n">per_page</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PaginatedCropListResponse</span><span class="p">(</span>
        <span class="n">crops</span><span class="o">=</span><span class="n">crops</span><span class="p">,</span>
        <span class="n">total_crops</span><span class="o">=</span><span class="n">total_crops</span><span class="p">,</span>
        <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
        <span class="n">per_page</span><span class="o">=</span><span class="n">per_page</span><span class="p">,</span>
        <span class="n">total_pages</span><span class="o">=</span><span class="n">total_pages</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  </body>
</html>